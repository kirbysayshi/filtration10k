(function(){function z(a){var b=Math.random();this.f=a;this.b=30*b+5;this.s=this.b*this.b;this.r=this.f?99:100*b+10;this.c=e.d(0,0,0);this.a=e.d(0,0,0);this.h=e.d(0,0,0);this.e=this.f?1/9E3:1/this.b;this.g=[];this.q=this.l=50;this.n=[];this.o=[]}function B(){k.sort(function(g,i){return g.a[2]-i.a[2]});for(var a,b=0;b<k.length;b++){a=k[b];h.fillStyle="rgba("+Math.floor(a.l*255)+","+(a.f?255:0)+",0,1)";h.strokeStyle="#CCCCCC";h.lineWidth=5;h.beginPath();h.arc(a.a[0],a.a[1],a.b*(1-a.a[2]/t[2]),0,Math.PI*
2,false);h.stroke();h.fill();h.lineWidth=1;h.fillStyle="#FFFFFF";h.fillText(a.q+"/"+a.l,a.a[0]+a.b+5,a.a[1]+a.b+5);h.strokeStyle="#339900";h.beginPath();for(var d=0;d<a.n.length;d++){var c=a.n[d];h.moveTo(a.a[0],a.a[1]);h.lineTo(c.a[0],c.a[1])}h.stroke();for(d=0;d<a.o.length;d++){h.fillStyle=a.f===true?"#3399FF":"#CC00CC";c=a.o[d];h.beginPath();h.arc(c[0],c[1],2,0,Math.PI*2,false);h.fill()}}for(a=0;a<m.length;a++){b=m[a];for(d=0;d<b.length;d++){c=b[d];for(var f=0;f<c.length;f++){h.strokeStyle="#CCCCCC";
h.strokeRect(a*p,d*p,p,p)}}}h.fillStyle="#FFFFFF";h.fillText(MM(60)[0],100,20)}function A(){for(var a=0;a<u.length;a++)for(var b=u[a],d=0;d<b.g.length;d++){var c=b.g[d];if(c.f!==true){var f=c.f?(c.r+(c.b+b.b))*2:(c.b+b.b)*4,g=f*f;f=c.e+b.e;if(!(f<1.0E-5)){var i=e.sub(c.a,b.a);g=g/(e.i(i,i)+g)-0.5;g*=-2;i=e.scale(i,g/f);b.a=e.add(b.a,e.scale(i,b.e));c.a=e.sub(c.a,e.scale(i,c.e))}}}}var y=document.getElementById("stage"),t=[y.width,y.height,1E3],h=y.getContext("2d"),l=Math.random();l=20*l+5;var k=[],
u=[],o=false,m=[],p=50,e={m:false,j:function(){e.j=typeof Float32Array!=="undefined"?Float32Array:Array;e.m=true},d:function(a,b,d){e.m===false&&e.j();var c=new e.j(3);c[0]=a;c[1]=b;c[2]=d;return c},add:function(a,b){return e.d(a[0]+b[0],a[1]+b[1],a[2]+b[2])},sub:function(a,b){return e.d(a[0]-b[0],a[1]-b[1],a[2]-b[2])},normalize:function(a){var b=a[0],d=a[1];a=a[2];var c=Math.sqrt(b*b+d*d+a*a);if(c){if(c==1)return e.d(b,d,a)}else return e.d(0,0,0);c=1/c;return e.d(b*c,d*c,a*c)},length:function(a){var b=
a[0],d=a[1];a=a[2];return Math.sqrt(b*b+d*d+a*a)},i:function(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]},scale:function(a,b){return e.d(a[0]*b,a[1]*b,a[2]*b)},k:function(a){return e.d(a[0],a[1],a[2])}};z.prototype={p:function(){for(var a,b=0,d=0;d<this.g.length;d++){var c=this.g[d];if(c.b>b&&c.f===false){b=c.b;a=c}}return e.length(e.sub(this.a,a.a))+b}};for(var v=Math.floor(l/4),n=0;n<v;n++){var j=new z(true),w=e.d(Math.floor(t[0]/(v+1)),Math.floor(t[1]/(v+1)*Math.random()),0);j.a=e.scale(w,n+1);j.c=
e.scale(w,n+1);k.push(j);u.push(j)}l=Math.floor(l/v);for(n=0;n<u.length;n++){j=u[n];v=Math.PI*2/l;for(w=0;w<l;w++){var x=new z(false),C=e.d(Math.cos(v*w),Math.sin(v*w),j.a[2]);x.a=e.add(j.a,e.scale(C,(j.b+x.b)*1.5));x.c=e.k(x.a);k.push(x);j.g.push(x);x.g.push(j)}n!==0&&j.g.push(u[n-1])}A();A();for(n=0;n<u.length;n++){j=u[n];l=j.p();j.a[0]=Math.max(0+l,Math.min(j.a[0],t[0]-l));j.a[1]=Math.max(0+l,Math.min(j.a[1],t[1]-l));j.c[0]=Math.max(0+l,Math.min(j.c[0],t[0]-l));j.c[1]=Math.max(0+l,Math.min(j.c[1],
t[1]-l))}y.addEventListener("mousedown",function(a){var b=999999999,d=e.d(a.clientX,a.clientY,0);console.log(a,d);for(a=0;a<k.length;a++){var c=e.length(e.sub(d,k[a].a));if(c<b){o=k[a];b=c}}console.log(o)},false);y.addEventListener("mouseup",function(){o=false},false);y.addEventListener("mousemove",function(a){if(o!==false){o.a[0]=a.clientX;o.a[1]=a.clientY;o.a[2]=0;o.c[0]=a.clientX;o.c[1]=a.clientY;o.c[2]=0}},false);var D=setInterval(function(){h.fillStyle="#000000";h.fillRect(0,0,t[0],t[1]);for(var a=
0;a<k.length;a++){var b=k[a];if(!b.f){b.h=e.add(b.h,e.d(0,0,-100));var d=e.k(b.a);b.a=e.add(e.add(e.sub(b.a,b.c),e.scale(b.h,9.0E-4)),b.a);b.c=d;b.h=e.d(0,0,0);b=b;b.a[2]=0;b.c[2]=0}}a=Math.floor(t[1]/p);b=Math.floor(t[0]/p);var c=d=0;m=[];for(d=0;d<b;d++){m[d]=[];for(c=0;c<a;c++)m[d][c]=[]}for(d=0;d<k.length;d++){c=k[d];var f=Math.floor(c.a[0]/p),g=Math.floor(c.a[1]/p),i=Math.floor((c.a[1]-c.b)/p),q=Math.floor((c.a[1]+c.b)/p),r=Math.floor((c.a[0]-c.b)/p),s=Math.floor((c.a[0]+c.b)/p);f>=0&&f<b&&g>=
0&&g<a&&m[f][g].push(c);i!==g&&i>=0&&i<a&&f<b&&f>=0&&m[f][i].push(c);q!==g&&q>=0&&q<a&&f<b&&f>=0&&m[f][q].push(c);r!==f&&r>=0&&r<b&&g<a&&g>=0&&m[r][g].push(c);s!==g&&s>=0&&s<b&&g<a&&g>=0&&m[s][g].push(c);s!==f&&i!==g&&s<b&&i<a&&s>=0&&i>=0&&m[s][i].push(c);s!==f&&q!==g&&s<b&&q<a&&s>=0&&q>=0&&m[s][q].push(c);r!==f&&i!==g&&r<b&&i<a&&r>=0&&i>=0&&m[r][i].push(c);r!==f&&q!==g&&r<b&&q<a&&r>=0&&q>=0&&m[r][q].push(c)}a:for(c=0;c<k.length;c++){a=k[c];for(g=0;g<k.length;g++){b=k[g];if(a!=b){d=e.sub(a.a,b.a);
i=a.b+b.b;f=e.i(d,d);if(!(f>=i*i)){if(a==o||b==o)console.log(o);c=a.e+b.e;f=Math.sqrt(f);d[0]/=f;d[1]/=f;d[2]/=f;b.a=e.sub(b.a,e.scale(d,f*b.e));a.a=e.add(a.a,e.scale(d,f*a.e));b.c=e.sub(b.c,e.scale(d,f*b.e*0.5));a.c=e.add(a.c,e.scale(d,f*a.e*0.5));f=e.sub(a.a,a.c);g=e.sub(b.a,b.c);f=e.sub(f,g);d=e.scale(d,e.i(f,d));d=e.sub(f,d);d[0]/=c;d[1]/=c;d[2]/=c;a.a=e.sub(a.a,e.scale(d,0.5*a.e));b.a=e.add(b.a,e.scale(d,0.5*b.e));break a}}}}A();B()},16);document.addEventListener("keydown",function(a){if(a.keyCode==
27){clearInterval(D);console.log("execution stopped")}},false)})();
