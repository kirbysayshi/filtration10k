(function(){function w(c){var f=Math.random();this.i=c;this.b=50*f;this.t=this.b*this.b;this.p=this.i?99:100*f;this.c=b.d(0,0,0);this.a=b.d(0,0,0);this.g=b.d(0,0,0);this.f=1/this.b;this.e=[];this.m=1}w.prototype={};var b={l:false,j:function(){b.j=typeof Float32Array!=="undefined"?Float32Array:Array;b.l=true},d:function(c,f,j){b.l==false&&b.j();var h=new b.j(3);h[0]=c;h[1]=f;h[2]=j;return h},add:function(c,f){return b.d(c[0]+f[0],c[1]+f[1],c[2]+f[2])},sub:function(c,f){return b.d(c[0]-f[0],c[1]-f[1],
c[2]-f[2])},normalize:function(c){var f=c[0],j=c[1];c=c[2];var h=Math.sqrt(f*f+j*j+c*c);if(h){if(h==1)return b.d(f,j,c)}else return b.d(0,0,0);h=1/h;return b.d(f*h,j*h,c*h)},length:function(c){var f=c[0],j=c[1];c=c[2];return Math.sqrt(f*f+j*j+c*c)},h:function(c,f){return c[0]*f[0]+c[1]*f[1]+c[2]*f[2]},scale:function(c,f){return b.d(c[0]*f,c[1]*f,c[2]*f)},k:function(c){return b.d(c[0],c[1],c[2])}},v=new (function(c){function f(a){a.a[0]=Math.max(0+a.b,Math.min(a.a[0],j[0]-a.b));a.a[1]=Math.max(0+a.b,
Math.min(a.a[1],j[1]-a.b));a.a[2]=Math.max(0+a.b,Math.min(a.a[2],j[2]-a.b));a.c[0]=Math.max(0+a.b,Math.min(a.c[0],j[0]-a.b));a.c[1]=Math.max(0+a.b,Math.min(a.c[1],j[1]-a.b));a.c[2]=Math.max(0+a.b,Math.min(a.c[2],j[2]-a.b));a.a[2]=0;a.c[2]=0}c=document.getElementById(c);for(var j=[c.width,c.height,1E3],h=c.getContext("2d"),u=25*Math.random(),l=[],t=[],q=Math.floor(u/4),o=0;o<q;o++){var n=new w(true),r=b.d(Math.floor(j[0]/(q+1)),Math.floor(j[1]/(q+1)),0);n.a=b.scale(r,o+1);n.c=b.scale(r,o+1);l.push(n);
t.push(n)}u=Math.floor(u/q);for(o=0;o<t.length;o++){n=t[o];q=Math.PI*2/u;for(r=0;r<u;r++){var s=new w(false),x=b.d(Math.cos(q*r),Math.sin(q*r),n.a[2]);s.a=b.add(n.a,b.scale(x,(n.b+s.b)*1.5));s.c=b.k(s.a);l.push(s);n.e.push(s);s.e.push(n)}o!=0&&n.e.push(t[o-1])}var m=false;c.addEventListener("mousedown",function(a){var d=999999999,e=b.d(a.clientX,a.clientY,0);console.log(a,e);for(a=0;a<l.length;a++){var g=b.length(b.sub(e,l[a].a));if(g<d){m=l[a];d=g}}},false);c.addEventListener("mouseup",function(){m=
false},false);c.addEventListener("mousemove",function(a){if(m!=false){m.a[0]=a.clientX;m.a[1]=a.clientY;m.a[2]=0;m.c[0]=a.clientX;m.c[1]=a.clientY;m.c[2]=0}},false);return{n:function(){h.fillStyle="#000000";h.fillRect(0,0,j[0],j[1]);for(var a={},d=0;d<l.length;d++){a=l[d];h.fillStyle="rgba("+Math.floor(a.m*255)+","+(a.i?255:0)+",0,1)";h.strokeStyle="#CCCCCC";h.beginPath();h.arc(a.a[0],a.a[1],a.b*(1-a.a[2]/j[2]),0,Math.PI*2,false);h.fill();if(a.e.length>0){h.beginPath();for(var e=0;e<a.e.length;e++){h.moveTo(a.a[0],
a.a[1]);h.quadraticCurveTo((a.a[0]+a.e[e].a[0])/2+30,(a.a[1]+a.e[e].a[1])/2+30,a.e[e].a[0],a.e[e].a[1])}h.stroke()}}h.fillStyle="#FFFFFF";h.fillText(MM(60)[0],100,20)},s:l,o:function(a){for(var d=0;d<l.length;d++){var e=l[d];e.g=b.add(e.g,b.d(0,0,-100));var g=b.k(e.a);e.a=b.add(b.add(b.sub(e.a,e.c),b.scale(e.g,a*a)),e.a);e.c=g;e.g=b.d(0,0,0);f(e)}l.sort(function(i,p){return i.a[2]-p.a[2]})},r:function(){for(var a=0;a<l.length;a++)for(var d=l[a],e=0;e<l.length;e++){var g=l[e];if(d!=g){var i=b.sub(d.a,
g.a),p=d.b+g.b,k=b.h(i,i);if(!(k>p*p)){console.log("collision");if(d==m||g==m)console.log(m);a=d.f+g.f;k=Math.sqrt(k);i[0]/=k;i[1]/=k;i[2]/=k;g.a=b.sub(g.a,b.scale(i,k*g.f));d.a=b.add(d.a,b.scale(i,k*d.f));k=b.sub(d.a,d.c);e=b.sub(g.a,g.c);k=b.sub(k,e);i=b.scale(i,b.h(k,i));i=b.sub(k,i);i[0]/=a;i[1]/=a;i[2]/=a;d.a=b.sub(d.a,b.scale(i,0.5*d.f));g.a=b.add(g.a,b.scale(i,0.5*g.f));return true}}}},q:function(){for(var a=0;a<t.length;a++)for(var d=t[a],e=0;e<d.e.length;e++){var g=d.e[e],i=g.i?(g.p+(g.b+
d.b))*2:(g.b+d.b)*1.5,p=i*i;i=g.f+d.f;if(!(i<1.0E-5)){var k=b.sub(g.a,d.a);p=p/(b.h(k,k)+p)-0.5;p*=-2;k=b.scale(k,p/i);d.a=b.add(d.a,b.scale(k,d.f));g.a=b.sub(g.a,b.scale(k,g.f))}}}}})("stage"),y=setInterval(function(){v.o(0.03);v.r();v.q();v.n()},16);document.addEventListener("keydown",function(c){if(c.keyCode==27){clearInterval(y);console.log("execution stopped")}},false)})();
