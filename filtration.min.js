(function(){function C(a){var b=Math.random();this.l=a;this.b=30*b+15;this.w=this.b*this.b;this.p=Math.max(Math.random(),this.b*0.01);this.d=c.c(0,0,0);this.a=c.c(0,0,0);this.e=c.c(0,0,0);this.g=this.l?1/9E3:1/this.b;this.j=[];this.f=99*Math.random()+1;this.h=[];this.o=Math.max((35-this.b)*20,200);this.m=Math.random()*this.o;this.n=99*b+1}function J(a,b,d){this.b=2;this.f=d;this.d=c.k(a.d);this.a=c.k(a.a);this.e=c.k(a.e);this.z=a;this.r=b}function K(){k.sort(function(g,i){return g.a[2]-i.a[2]});for(var a,
b=0;b<k.length;b++){a=k[b];h.fillStyle="rgba("+Math.round((100-a.f)*0.01*255)+","+Math.round(a.f*0.01*255)+",0,1)";h.beginPath();h.arc(a.a[0],a.a[1],a.b*(1-a.a[2]/n[2]),0,Math.PI*2,false);h.fill();h.save();h.strokeStyle="rgba(204,204,204,0.4)";h.lineWidth=Math.max(Math.floor(a.n*a.n*0.0050),4);h.beginPath();h.arc(a.a[0],a.a[1],a.b*(1-a.a[2]/n[2]),0,Math.PI*2*(a.m/a.o),false);h.stroke();h.restore();h.save();h.strokeStyle="#CCCCCC";h.beginPath();h.arc(a.a[0],a.a[1],a.p*100*(1-a.a[2]/n[2]),0,Math.PI*
2,false);h.stroke();h.restore();h.save();h.fillStyle="#FFFFFF";h.font="bold 14px arial";h.fillText(Math.floor(a.f),a.a[0]-7,a.a[1]+4);h.restore();if(B===true){h.strokeStyle="#339900";h.beginPath();for(var d=0;d<a.h.length;d++){var e=a.h[d];h.moveTo(a.a[0],a.a[1]);h.lineTo(e.a[0],e.a[1])}h.stroke()}}if(B===true)for(a=0;a<q.length;a++){b=q[a];for(d=0;d<b.length;d++){e=b[d];for(var f=0;f<e.length;f++){h.strokeStyle="#CCCCCC";h.strokeRect(a*s,d*s,s,s)}}}h.fillStyle="#3399FF";for(a=h.lineWidth=0;a<u.length;a++){b=
u[a];h.beginPath();h.arc(b.a[0],b.a[1],b.b*(1-b.a[2]/n[2]),0,Math.PI*2,false);h.fill()}h.lineWidth=1;h.fillStyle="#FFFFFF";h.fillText(MM(60)[0],100,20);h.fillText("Reinforcements Remaining: "+D,n[0]-200,n[1]-10)}function G(){for(var a=0;a<v.length;a++)for(var b=v[a],d=0;d<b.j.length;d++){var e=b.j[d];if(e.l!==true){var f=(e.b+b.b)*2+50*e.p,g=f*f;f=e.g+b.g;if(!(f<1.0E-5)){var i=c.sub(e.a,b.a);g=g/(c.i(i,i)+g)-0.5;g*=-2;i=c.scale(i,g/f);b.a=c.add(b.a,c.scale(i,b.g));e.a=c.sub(e.a,c.scale(i,e.g))}}}}
function H(a){var b=c.c(n[0],0,0),d=c.c(n[0],n[1],0),e=c.sub(d,b);d=c.c(-e[1],e[0],e[2]);d=c.normalize(d);var f=c.sub(a.a,b);f=c.i(f,e);if(!(f<0)){var g=c.i(e,e);if(!(f>g)){f=f/g;g=1-f;b=c.add(b,c.scale(e,f));d=c.add(c.scale(d,g),c.scale(d,f));d=c.normalize(d);return(new Vertex(b,d)).v(a)}}}function I(a){for(var b=0;b<k.length;b++){var d=k[b];d.u();if(!d.l){d.e=c.add(d.e,c.c(0,0,-100));var e=c.k(d.a),f=c.add(c.sub(d.a,d.d),c.scale(d.e,a*a));d.a=c.add(f,d.a);d.d=c.add(c.scale(f,0.1),e);d.e=c.c(0,0,
0);H(d)}}}var c={s:false,q:function(){c.q=typeof Float32Array!=="undefined"?Float32Array:Array;c.s=true},c:function(a,b,d){c.s===false&&c.q();var e=new c.q(3);e[0]=a;e[1]=b;e[2]=d;return e},add:function(a,b){return c.c(a[0]+b[0],a[1]+b[1],a[2]+b[2])},sub:function(a,b){return c.c(a[0]-b[0],a[1]-b[1],a[2]-b[2])},normalize:function(a){var b=a[0],d=a[1];a=a[2];var e=Math.sqrt(b*b+d*d+a*a);if(e){if(e==1)return c.c(b,d,a)}else return c.c(0,0,0);e=1/e;return c.c(b*e,d*e,a*e)},length:function(a){var b=a[0],
d=a[1];a=a[2];return Math.sqrt(b*b+d*d+a*a)},i:function(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]},scale:function(a,b){return c.c(a[0]*b,a[1]*b,a[2]*b)},k:function(a){return c.c(a[0],a[1],a[2])}},A=document.getElementById("stage"),n=[A.width,A.height,1E3];c.length(n);var h=A.getContext("2d"),p=Math.random();p=10*p+5;var k=[],v=[],u=[],t=false,q=[],s=50,D=100,B=false;C.prototype={u:function(){if(this.h.length===0)return false;this.m++;if(this.m>=this.o){this.m=0;this.h.sort(function(l,j){return l.b-
j.b});for(var a=Math.floor(this.b/2),b=Math.PI*2/a,d=this.h.length,e=this.f<75?this.n*-1:this.n,f=0;f<a;f++){var g=new J(this,this.h[f%d],e);g.e[0]=Math.cos(b*1)*1E3;g.e[1]=Math.sin(b*1)*1E3;g.e[2]=0;var i=c.c(Math.cos(b*f)*this.b,Math.sin(b*f)*this.b,0);g.a=c.add(g.a,i);g.d=c.add(g.d,i);u.push(g)}}},t:function(){for(var a,b=0,d=0;d<this.j.length;d++){var e=this.j[d];if(e.b>b&&e.l===false){b=e.b;a=e}}return c.length(c.sub(this.a,a.a))+b}};for(var w=Math.floor(p/4),r=0;r<w;r++){var m=new C(true),x=
c.c(Math.floor(n[0]/(w+1)),Math.floor(n[1]/(w+1)*Math.random()),0);m.a=c.scale(x,r+1);m.d=c.scale(x,r+1);k.push(m);v.push(m)}p=Math.floor(p/w);for(r=0;r<v.length;r++){m=v[r];w=Math.PI*2/p;for(x=0;x<p;x++){var y=new C(false),L=c.c(Math.cos(w*x),Math.sin(w*x),m.a[2]);y.a=c.add(m.a,c.scale(L,(m.b+y.b)*1.5));y.d=c.k(y.a);k.push(y);m.j.push(y);y.j.push(m)}r!==0&&m.j.push(v[r-1])}G();G();I(1);for(r=0;r<v.length;r++){m=v[r];p=m.t();m.a[0]=Math.max(0+p,Math.min(m.a[0],n[0]-p));m.a[1]=Math.max(0+p,Math.min(m.a[1],
n[1]-p));m.d[0]=Math.max(0+p,Math.min(m.d[0],n[0]-p));m.d[1]=Math.max(0+p,Math.min(m.d[1],n[1]-p))}A.addEventListener("mousedown",function(a){var b=999999999,d=c.c(a.clientX,a.clientY,0);console.log(a,d);for(a=0;a<k.length;a++){var e=c.length(c.sub(d,k[a].a));if(e<b){t=k[a];b=e}}console.log(t)},false);A.addEventListener("mouseup",function(a){if(a.shiftKey)if(t!==false&&D>=1){t.f+=100;D-=1}t=false},false);A.addEventListener("mousemove",function(a){if(t!==false&&!a.shiftKey){t.a[0]=a.clientX;t.a[1]=
a.clientY;t.a[2]=0;t.d[0]=a.clientX;t.d[1]=a.clientY;t.d[2]=0}},false);var M=setInterval(function(){h.fillStyle="#000000";h.fillRect(0,0,n[0],n[1]);I(0.03);for(var a=0;a<u.length;a++){var b=u[a],d=c.scale(c.normalize(c.sub(b.r.a,b.a)),b.r.b*100);b.e=c.add(b.e,d);d=c.k(b.a);var e=c.add(c.sub(b.a,b.d),c.scale(b.e,9.0E-4));b.a=c.add(e,b.a);b.d=c.add(c.scale(e,0.1),d);b.e=c.c(0,0,0);H(b)}a=Math.floor(n[1]/s);b=Math.floor(n[0]/s);e=d=0;q=[];for(d=0;d<=b;d++){q[d]=[];for(e=0;e<=a;e++)q[d][e]=[]}for(d=0;d<
k.length;d++){e=k[d];var f=Math.floor(e.a[0]/s),g=Math.floor(e.a[1]/s),i=Math.floor((e.a[1]-e.b)/s),l=Math.floor((e.a[1]+e.b)/s),j=Math.floor((e.a[0]-e.b)/s),o=Math.floor((e.a[0]+e.b)/s);f>=0&&f<b&&g>=0&&g<a&&q[f][g].push(e);i!==g&&i>=0&&i<a&&f<b&&f>=0&&q[f][i].push(e);l!==g&&l>=0&&l<a&&f<b&&f>=0&&q[f][l].push(e);j!==f&&j>=0&&j<b&&g<a&&g>=0&&q[j][g].push(e);o!==g&&o>=0&&o<b&&g<a&&g>=0&&q[o][g].push(e);o!==f&&i!==g&&o<b&&i<a&&o>=0&&i>=0&&q[o][i].push(e);o!==f&&l!==g&&o<b&&l<a&&o>=0&&l>=0&&q[o][l].push(e);
j!==f&&i!==g&&j<b&&i<a&&j>=0&&i>=0&&q[j][i].push(e);j!==f&&l!==g&&j<b&&l<a&&j>=0&&l>=0&&q[j][l].push(e)}a:for(e=0;e<k.length;e++){a=k[e];for(g=0;g<k.length;g++){b=k[g];if(a!=b){d=c.sub(a.a,b.a);i=a.b+b.b;f=c.i(d,d);if(!(f>=i*i)){e=a.g+b.g;f=Math.sqrt(f);d[0]/=f;d[1]/=f;d[2]/=f;b.a=c.sub(b.a,c.scale(d,f*b.g));a.a=c.add(a.a,c.scale(d,f*a.g));f=c.sub(a.a,a.d);g=c.sub(b.a,b.d);f=c.sub(f,g);d=c.scale(d,c.i(f,d));d=c.sub(f,d);d[0]/=e;d[1]/=e;d[2]/=e;a.a=c.sub(a.a,c.scale(d,1*a.g));b.a=c.add(b.a,c.scale(d,
1*b.g));break a}}}}a=[];for(b=0;b<u.length;b++){d=u[b];e=d.r;f=c.sub(d.a,e.a);if(c.i(f,f)>=(d.b+e.b)*(d.b+e.b))a.push(d);else{e.f+=d.f*(1-e.p);e.f=e.f<=0?0:e.f;e.e=c.add(e.e,c.sub(d.a,d.d))}}u=a;a=[];b=false;d=0;l=true;for(e=0;e<k.length;e++){f=k[e];f.h=[];for(g=0;g<k.length;g++){i=k[g];if(f!==i){for(l=0;l<a.length;l++){j=a[l];if(j[0]===f&&j[1]===i||j[0]===i&&j[1]===f)b=true;j[0]===i&&j[1]===f&&j[2]===true&&f.h.push(i)}if(b===true)b=false;else{l=true;j=c.sub(i.a,f.a);o=c.length(j);j=c.scale(j,1/o);
for(o=0;o<k.length;o++){var z=k[o];if(!(f===z||i===z)){var E=c.sub(z.a,f.a),F=c.i(E,j);if(!(F<0)){z=z.b*z.b-c.i(E,E)+F*F;d++;if(!(z<0)){l=false;break}}}}if(l===true){f.h.push(i);a.push([f,i,true])}else a.push([f,i,false])}}}}K()},33);document.addEventListener("keydown",function(a){if(a.keyCode==27){clearInterval(M);console.log("execution stopped")}if(a.keyCode==68)B=true},false);document.addEventListener("keyup",function(a){if(a.keyCode==68)B=false},false)})();
